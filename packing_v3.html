<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>×¦×³×§-×œ×™×¡×˜ ××¨×™×–×”</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e5e7eb;
      --shadow: 0 12px 28px rgba(15,23,42,.08);
      --good: #16a34a;
      --good-bg: rgba(22,163,74,.12);
      --danger: #ef4444;
      --chip: #eef2ff;
      --chipText: #3730a3;
      --focus: rgba(59,130,246,.25);
    }
    [data-theme="dark"] {
      --bg: #0b0f14;
      --card: #111827;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --border: #1f2a3a;
      --shadow: 0 12px 28px rgba(0,0,0,.38);
      --good: #22c55e;
      --good-bg: rgba(34,197,94,.14);
      --danger: #fb7185;
      --chip: rgba(99,102,241,.18);
      --chipText: #c7d2fe;
      --focus: rgba(59,130,246,.35);
    }
    *{ box-sizing:border-box; }
    body {
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .wrap {
      max-width: 820px;
      margin: 0 auto;
      padding: 14px 14px 90px;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: color-mix(in srgb, var(--bg) 88%, transparent);
      backdrop-filter: blur(10px);
      padding: 10px 0 12px;
    }
    .topbar {
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .title {
      display:flex;
      flex-direction:column;
      gap:4px;
      line-height:1.1;
    }
    .title h1 {
      margin:0;
      font-size: 20px;
      font-weight: 800;
      letter-spacing: .2px;
    }
    .subtitle {
      font-size: 12px;
      color: var(--muted);
    }
    .actions {
      display:flex;
      gap:8px;
      align-items:center;
    }
    button, .btn {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 700;
      font-size: 13px;
      box-shadow: 0 1px 0 rgba(0,0,0,.03);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    button:active { transform: translateY(1px); }
    .btn-ghost {
      background: transparent;
      box-shadow:none;
    }
    .btn-danger {
      border-color: color-mix(in srgb, var(--danger) 30%, var(--border));
      color: var(--danger);
    }
    .search {
      display:flex;
      gap:10px;
      align-items:center;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px 12px;
      border: 1px solid var(--border);
      border-radius: 14px;
      outline: none;
      background: var(--card);
      color: var(--text);
      font-size: 14px;
    }
    input[type="text"]:focus {
      box-shadow: 0 0 0 4px var(--focus);
      border-color: color-mix(in srgb, #3b82f6 45%, var(--border));
    }
    .chips {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .chip {
      padding: 7px 10px;
      border-radius: 999px;
      background: var(--chip);
      color: var(--chipText);
      font-weight: 800;
      font-size: 12px;
      border: 1px solid color-mix(in srgb, var(--chipText) 12%, transparent);
      cursor:pointer;
      user-select:none;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 12px;
    }
    .progressline {
      height: 10px;
      background: color-mix(in srgb, var(--border) 70%, transparent);
      border-radius: 999px;
      overflow:hidden;
      border: 1px solid color-mix(in srgb, var(--border) 90%, transparent);
    }
    .bar {
      height: 100%;
      width: 0%;
      background: var(--good);
      border-radius: 999px;
      transition: width .25s ease;
    }
    .grid {
      display:grid;
      gap:12px;
      margin-top: 12px;
    }
    details.category {
      border: 1px solid var(--border);
      border-radius: 18px;
      background: var(--card);
      box-shadow: 0 10px 22px rgba(0,0,0,.05);
      overflow:hidden;
    }
    details.category.done {
      border-color: color-mix(in srgb, var(--good) 45%, var(--border));
      background: linear-gradient(0deg, var(--good-bg), var(--card));
    }
    summary {
      list-style:none;
      cursor:pointer;
      padding: 14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    summary::-webkit-details-marker { display:none; }
    .sum-left {
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
    }
    .sum-title {
      display:flex;
      gap:8px;
      align-items:center;
      font-weight: 900;
      font-size: 16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sum-meta {
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .pct {
      font-weight: 900;
      color: color-mix(in srgb, var(--good) 70%, var(--text));
    }
    .chev {
      font-size: 18px;
      color: var(--muted);
      transform: rotate(0deg);
      transition: transform .2s ease;
    }
    details[open] .chev { transform: rotate(180deg); }
    .items {
      padding: 0 12px 12px;
      display:grid;
      gap:8px;
    }
    .item {
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border: 1px solid color-mix(in srgb, var(--border) 90%, transparent);
      border-radius: 14px;
      background: color-mix(in srgb, var(--card) 92%, transparent);
    }
    .item .txt {
      flex:1;
      font-size: 14px;
      line-height: 1.25;
    }
    .item.done .txt {
      text-decoration: line-through;
      color: var(--muted);
    }
    .trash {
      border:none;
      background: transparent;
      padding: 6px 8px;
      border-radius: 10px;
      color: var(--danger);
      font-weight: 900;
      cursor:pointer;
    }
    .trash:active { transform: translateY(1px); }
    input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: var(--good);
    }
    .addrow {
      display:flex;
      gap:10px;
      margin-top: 10px;
    }
    .small {
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
    }
    .footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 12px 14px calc(12px + env(safe-area-inset-bottom));
      background: color-mix(in srgb, var(--bg) 90%, transparent);
      backdrop-filter: blur(10px);
      border-top: 1px solid color-mix(in srgb, var(--border) 70%, transparent);
    }
    .footer .card {
      max-width: 820px;
      margin: 0 auto;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
    }
    .footer .left {
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .footer .right {
      display:flex;
      gap:8px;
      align-items:center;
    }
    .kbd {
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
    }
    .mono {
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum";
    }
    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; }
    }
  
    /* Tabs */
    .tabs{display:flex;gap:8px;margin:10px 0 14px;flex-wrap:wrap;}
    .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--card);text-decoration:none;color:var(--text);font-weight:700;font-size:14px;line-height:1;}
    .tab.active{background:var(--chip);border-color:transparent;}
    .tab:active{transform:translateY(1px);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="topbar">
        <div class="title">
          <h1>×¦×³×§-×œ×™×¡×˜ ××¨×™×–×”</h1>
          <div class="subtitle">××™× ×™-××¤×œ×™×§×¦×™×” ××§×•××™×ª â€¢ × ×©××¨ ××•×˜×•××˜×™×ª ×‘××›×©×™×¨</div>
        </div>
        <div class="actions">
          <button id="themeBtn" class="btn" title="××¦×‘ ×‘×”×™×¨/×›×”×”">â˜€ï¸</button>
          <button id="resetBtn" class="btn btn-danger" title="××™×¤×•×¡ ×¡×™××•× ×™×">××™×¤×•×¡</button>
        </div>
      </div>

      <nav class="tabs" aria-label="× ×™×•×•×˜">
        <a class="tab active" href="packing_v3.html">ğŸ’ Packing</a>
        <a class="tab" href="expenses.html">ğŸ’° ××œ×•× ×•×ª / ×‘×™×˜×•×œ ×—×™× ×</a>
      </nav>

      <div class="card">
        <div class="search">
          <input id="search" type="text" placeholder="×—×™×¤×•×© ×¤×¨×™×˜ (×œ×“×•×’××”: ××˜×¢×Ÿ / ×“×¨×›×•×Ÿ)" />
        </div>
        <div class="chips" id="chips"></div>
        <div style="margin-top:10px;">
          <div class="progressline" aria-label="×”×ª×§×“××•×ª ×›×œ×œ×™×ª"><div class="bar" id="globalBar"></div></div>
          <div class="small"><span class="mono" id="globalStats">0/0</span> â€¢ <span id="globalPct">0%</span></div>
        </div>
      </div>
    </header>

    <main class="grid" id="app"></main>
  </div>

  <div class="footer">
    <div class="card">
      <div class="left">
        <div><strong>×˜×™×¤ ×œ××™×™×¤×•×Ÿ:</strong> Share â†’ Add to Home Screen</div>
        <div class="kbd">×”×•×¡×¤×”/××—×™×§×” × ×©××¨×™× ×‘××›×©×™×¨</div>
      </div>
      <div class="right">
        <button id="restoreBtn" class="btn btn-ghost" title="×—×–×¨×” ×œ××§×•×¨ ××”××§×¡×œ">×©×—×–×•×¨ ××§×•×¨</button>
      </div>
    </div>
  </div>

  <script>
  const STORAGE_KEY = "packing_app_v3_data";
  const THEME_KEY = "packing_app_v3_theme";
  const BASE_DATA = [{"id": "cat0", "name": "×‘×™×’×•×“", "items": [{"id": "c0_i0", "text": "6 ×—×•×œ×¦×•×ª", "checked": false}, {"id": "c0_i1", "text": "2 ××›× ×¡×™×™× ×§×¦×¨×™×", "checked": false}, {"id": "c0_i2", "text": "1 ××›× ×¡ ××¨×•×š", "checked": false}, {"id": "c0_i3", "text": "×—×•×œ×¦×ª ×©×™× ×”", "checked": false}, {"id": "c0_i4", "text": "2,3 ×‘×’×“×™ ×™×", "checked": false}, {"id": "c0_i5", "text": "7 ×ª×—×ª×•× ×™×", "checked": false}, {"id": "c0_i6", "text": "7 ×’×¨×‘×™×™×", "checked": false}, {"id": "c0_i7", "text": "×¡×•×•×™×˜×©×™×¨×˜ 1", "checked": false}], "open": true}, {"id": "cat1", "name": "×”× ×¢×œ×”", "items": [{"id": "c1_i0", "text": "× ×¢×œ×™ ×¡×¤×•×¨×˜ ×˜×•×‘×•×ª ×œ×”×œ×™×›×”", "checked": false}, {"id": "c1_i1", "text": "×›×¤×›×¤×™× - ×œ×§×—×ª ×œ××˜×•×¡ ×’×", "checked": false}, {"id": "c1_i2", "text": "×¡× ×“×œ×™ ×©×•×¨×©", "checked": false}], "open": true}, {"id": "cat2", "name": "×›×œ×™ ×¨×—×¦×” ×•×˜×™×¤×•×—", "items": [{"id": "c2_i0", "text": "××‘×¨×©×ª ×©×™× ×™×™× + ××©×—×”", "checked": false}, {"id": "c2_i1", "text": "×“××•×¨×“×•×¨× ×˜", "checked": false}, {"id": "c2_i2", "text": "×§×¨× ×”×’× ×”, ×œ×©×œ×•×— ×œ×‘×˜×Ÿ ×”××˜×•×¡", "checked": false}, {"id": "c2_i3", "text": "×‘×•×©× ×§×˜×Ÿ", "checked": false}, {"id": "c2_i4", "text": "××œ×›×•×’×œ", "checked": false}], "open": true}, {"id": "cat3", "name": "×ª×¨×•×¤×•×ª", "items": [{"id": "c3_i0", "text": "×ª×¨×•×¤×•×ª ×§×‘×•×¢×•×ª", "checked": false}, {"id": "c3_i1", "text": "×’×œ×•×œ×•×ª", "checked": false}, {"id": "c3_i2", "text": "××©×›×›×™ ×›××‘×™×", "checked": false}, {"id": "c3_i3", "text": "×›×“×•×¨×™× ×œ×‘×˜×Ÿ ×•×©×œ×©×•×œ", "checked": false}, {"id": "c3_i4", "text": "×¤×œ×¡×˜×¨×™×", "checked": false}, {"id": "c3_i5", "text": "× ×’×“ ×™×ª×•×©×™× 1, ×§×•× ×™× ×©× ×¢×•×“", "checked": false}, {"id": "c3_i6", "text": "×§×¨× × ×’×“ ×©×¤×©×¤×ª", "checked": false}, {"id": "c3_i7", "text": "××˜××™ ××•×–× ×™×™×", "checked": false}], "open": true}, {"id": "cat4", "name": "××œ×§×˜×¨×•× ×™", "items": [{"id": "c4_i0", "text": "×˜×œ×¤×•×Ÿ", "checked": false}, {"id": "c4_i1", "text": "××˜×¢×Ÿ", "checked": false}, {"id": "c4_i2", "text": "××˜×¢×Ÿ × ×™×™×“ ×× ×™×©", "checked": false}, {"id": "c4_i3", "text": "××•×–× ×™×•×ª", "checked": false}, {"id": "c4_i4", "text": "××ª×× ×—×©××œ ×—×•×‘×”", "checked": false}], "open": true}, {"id": "cat5", "name": "××¡××›×™×", "items": [{"id": "c5_i0", "text": "×“×¨×›×•×Ÿ", "checked": false}, {"id": "c5_i1", "text": "×¦×™×œ×•× ×“×¨×›×•×Ÿ", "checked": false}, {"id": "c5_i2", "text": "×‘×™×˜×•×— × ×¡×™×¢×•×ª, ××™×©×•×¨ ×‘×™×˜×•×—", "checked": false}, {"id": "c5_i3", "text": "××©×¨××™", "checked": false}, {"id": "c5_i4", "text": "××–×•××Ÿ (600 ×“×•×œ×¨ ×œ×¤×—×•×ª), ×œ×¤×¢××™× ××‘×§×©×™× ×œ×”×¦×™×’ ×©×™×© ×›×¡×£ ×•××™×Ÿ ×œ×š ××™×š ×•×œ×”×•×¦×™× ×©× ××”×›×¡×¤×•××˜ ×‘×©×“×“×” ×œ×œ×¤× ×™ ×©×× ×™ ×‘×", "checked": false}], "open": true}, {"id": "cat6", "name": "×©×˜×•×™×•×ª × ×•×¡×¤×•×ª ×—×©×•×‘×•×ª", "items": [{"id": "c6_i0", "text": "×× ×¢×•×œ ×§×˜×Ÿ ×× ×™×©", "checked": false}, {"id": "c6_i1", "text": "×‘×§×‘×•×§ ×©××¤×• ×§×˜×Ÿ", "checked": false}, {"id": "c6_i2", "text": "×¡×¤×¨", "checked": false}, {"id": "c6_i3", "text": "×§×™× ×“×œ", "checked": false}, {"id": "c6_i4", "text": "××’×‘×ª ××™×§×¨×•×¤×™×™×‘×¨ ×× ×™×©", "checked": false}], "open": true}];

  // helpers
  const $ = (sel, el=document) => el.querySelector(sel);
  const uid = () => "u" + Math.random().toString(16).slice(2) + Date.now().toString(16);

  function deepClone(x){ return JSON.parse(JSON.stringify(x)); }

  function loadData(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return deepClone(BASE_DATA);
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed)) return deepClone(BASE_DATA);
      return parsed;
    }catch(e){ return deepClone(BASE_DATA); }
  }

  function saveData(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

  function loadTheme(){
    const t = localStorage.getItem(THEME_KEY);
    if(t==="dark" || t==="light") return t;
    return (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
  }
  function saveTheme(t){ localStorage.setItem(THEME_KEY, t); }

  function setTheme(t){
    document.documentElement.setAttribute("data-theme", t);
    saveTheme(t);
    $("#themeBtn").textContent = (t==="dark") ? "ğŸŒ™" : "â˜€ï¸";
  }

  function normalize(str){ return (str||"").toString().trim().toLowerCase(); }

  function categoryProgress(cat){
    const total = cat.items.length;
    const done = cat.items.filter(i=>i.checked).length;
    const pct = total ? Math.round((done/total)*100) : 0;
    return {total, done, pct};
  }

  function globalProgress(data){
    let total=0, done=0;
    data.forEach(cat=>{
      total += cat.items.length;
      done += cat.items.filter(i=>i.checked).length;
    });
    const pct = total ? Math.round((done/total)*100) : 0;
    return {total, done, pct};
  }

  // state
  let data = loadData();
  let query = "";
  let activeChip = "all";

  function renderChips(){
    const chips = $("#chips");
    chips.innerHTML = "";

    const mk = (label, id) => {
      const d = document.createElement("div");
      d.className = "chip";
      d.textContent = label;
      d.style.opacity = (activeChip===id) ? "1" : ".65";
      d.onclick = ()=>{ activeChip=id; render(); };
      return d;
    };

    chips.appendChild(mk("×”×›×•×œ", "all"));
    data.forEach(cat=> chips.appendChild(mk(cat.name, cat.id)));
  }

  function renderGlobal(){
    const g = globalProgress(data);
    $("#globalStats").textContent = `${g.done}/${g.total}`;
    $("#globalPct").textContent = `${g.pct}%`;
    $("#globalBar").style.width = `${g.pct}%`;
  }

  function render(){
    renderChips();
    const app = $("#app");
    app.innerHTML = "";
    const q = normalize(query);

    const cats = (activeChip==="all") ? data : data.filter(c=>c.id===activeChip);

    cats.forEach(cat=>{
      const prog = categoryProgress(cat);
      const isDone = prog.total>0 && prog.done===prog.total;

      const details = document.createElement("details");
      details.className = "category" + (isDone ? " done" : "");
      details.open = !!cat.open;

      const summary = document.createElement("summary");

      const left = document.createElement("div");
      left.className = "sum-left";

      const title = document.createElement("div");
      title.className = "sum-title";
      title.textContent = cat.name;

      const meta = document.createElement("div");
      meta.className = "sum-meta";
      meta.innerHTML = `<span class="mono">${prog.done}/${prog.total}</span> <span class="pct">${prog.pct}%</span>`;

      left.appendChild(title);
      left.appendChild(meta);

      const chev = document.createElement("div");
      chev.className = "chev";
      chev.textContent = "âŒƒ";

      summary.appendChild(left);
      summary.appendChild(chev);
      details.appendChild(summary);

      details.addEventListener("toggle", ()=>{
        cat.open = details.open;
        saveData(data);
      });

      const itemsWrap = document.createElement("div");
      itemsWrap.className = "items";

      // items
      cat.items.forEach(item=>{
        const match = !q || normalize(item.text).includes(q);
        if(!match) return;

        const row = document.createElement("div");
        row.className = "item" + (item.checked ? " done" : "");

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!item.checked;
        cb.onchange = ()=>{
          item.checked = cb.checked;
          saveData(data);
          renderGlobal();
          render(); // update category coloring
        };

        const txt = document.createElement("div");
        txt.className = "txt";
        txt.textContent = item.text;

        const del = document.createElement("button");
        del.className = "trash";
        del.title = "××—×§";
        del.textContent = "ğŸ—‘ï¸";
        del.onclick = ()=>{
          cat.items = cat.items.filter(i=>i.id!==item.id);
          saveData(data);
          renderGlobal();
          render();
        };

        row.appendChild(cb);
        row.appendChild(txt);
        row.appendChild(del);
        itemsWrap.appendChild(row);
      });

      // add item row
      const addRow = document.createElement("div");
      addRow.className = "addrow";

      const inp = document.createElement("input");
      inp.type = "text";
      inp.placeholder = "â• ×”×•×¡×£ ×¤×¨×™×˜ ×—×“×© ×œ×§×˜×’×•×¨×™×”...";
      inp.autocomplete = "off";

      const addBtn = document.createElement("button");
      addBtn.textContent = "×”×•×¡×£";
      addBtn.onclick = ()=>{
        const t = (inp.value||"").trim();
        if(!t) return;
        cat.items.push({id: uid(), text: t, checked:false});
        inp.value="";
        saveData(data);
        renderGlobal();
        render();
      };
      inp.addEventListener("keydown", (e)=>{ if(e.key==="Enter") addBtn.click(); });

      addRow.appendChild(inp);
      addRow.appendChild(addBtn);
      itemsWrap.appendChild(addRow);

      const hint = document.createElement("div");
      hint.className = "small";
      hint.textContent = "××—×™×§×” ×¢× ğŸ—‘ï¸ â€¢ ×”×•×¡×¤×” × ×©××¨×ª ××•×˜×•××˜×™×ª";
      itemsWrap.appendChild(hint);

      details.appendChild(itemsWrap);
      app.appendChild(details);
    });

    renderGlobal();
  }

  // controls
  $("#search").addEventListener("input", (e)=>{ query = e.target.value; render(); });

  $("#themeBtn").addEventListener("click", ()=>{
    const current = document.documentElement.getAttribute("data-theme") || "light";
    setTheme(current==="dark" ? "light" : "dark");
  });

  $("#resetBtn").addEventListener("click", ()=>{
    data.forEach(cat=>cat.items.forEach(i=>i.checked=false));
    saveData(data);
    render();
  });

  $("#restoreBtn").addEventListener("click", ()=>{
    data = deepClone(BASE_DATA);
    saveData(data);
    render();
  });

  // init
  setTheme(loadTheme());
  render();
  </script>
</body>
</html>
